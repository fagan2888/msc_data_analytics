select(recipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE)) %>%
select(-lettuce_sub)
total_lettuce <- sub_to_recipe %>%
full_join(sub_to_recipe) %>%
select(recipeid, lettuce, lettuce_sub)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe) %>%
select(recipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE)) %>%
select(-lettuce_sub)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe) %>%
select(recipeid, lettuce, lettuce_sub)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe) %>%
select(recipeid, lettuce, lettuce_sub)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe) %>%
select(recipeid, lettuce, lettuce_sub)
View(total_lettuce)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid')) %>%
select(recipeid, lettuce, lettuce_sub)
# Amount of lettuce required in total for each recipe
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid'))
View(sub_to_recipe)
sub_to_recipe <- recipe_sub_recipe_assignments %>%
select(recipeid, subrecipeid, factor) %>%
inner_join(lettuce_sub_recipe, copy = TRUE) %>%
mutate(lettuce_sub = factor * lettuce) %>%
select(recipeid, subrecipeid, lettuce_sub)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid'))
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid')) %>%
select(recipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE))
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid')) %>%
select(recipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE)) %>%
select(-lettuce_sub, -subrecipeid)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid')) %>%
select(recipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(tot_lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE)) %>%
select(-lettuce, -lettuce_sub, -subrecipeid)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid')) %>%
select(recipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(tot_lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE)) %>%
select(-lettuce, -lettuce_sub)
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid')) %>%
select(recipeid, subrecipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(tot_lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE)) %>%
select(-lettuce, -lettuce_sub, -subrecipeid)
lettuce_menuitem <- menu_items %>%
inner_join(total_lettuce)
View(lettuce_menuitem)
# Get past sales by menuitem
ingredients_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(ingredient_by_recipe, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
mutate(lettuce_dde = total_lettuce * quantity)
# Get past sales by menuitem
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(ingredient_by_recipe, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
mutate(lettuce_dde = total_lettuce * quantity)
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
mutate(lettuce_dde = total_lettuce * quantity)
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu"))
View(lettuce_demand_by_menuitem)
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
mutate(lettuce_dde = tot_lettuce * quantity)
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
mutate(lettuce = tot_lettuce * quantity) %>%
select(md5key_ordersale, lettuce_dde) %>%
group_by(md5key_ordersale) %>%
summarise(lettuce_dde = sum(lettuce))
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
rowwise() %>%
mutate(lettuce = tot_lettuce * quantity) %>%
select(date, lettuce_dde) %>%
group_by(date) %>%
summarise(lettuce_dde = sum(lettuce))
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu"))
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
rowwise() %>%
mutate(lettuce = tot_lettuce * quantity) %>%
select(date, lettuce_dde) %>%
group_by(date) %>%
summarise(lettuce_dde = sum(lettuce))
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
rowwise() %>%
mutate(lettuce = tot_lettuce * quantity) %>%
select(date, md5key_ordersale, lettuce) %>%
group_by(date, md5key_ordersale) %>%
summarise(lettuce_dde = sum(lettuce))
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
rowwise() %>%
mutate(lettuce = tot_lettuce * quantity) %>%
select(date, md5key_ordersale, lettuce) %>%
group_by(date, md5key_ordersale) %>%
summarise(lettuce_dde = sum(lettuce))
lettuce_demand_by_shop <- pos_ordersale %>%
inner_join(lettuce_demand_by_menuitem) %>%
select(date, storenumber, lettuce) %>%
mutate(storenumber = as.character(storenumber)) %>%
filter(storenumber %in% c('46673', '4904', '12631', '20974')) %>%
mutate(ninth_46673 = ifelse(storenumber=='46673', lettuce, 0),
shattuck_4904 = ifelse(storenumber=='4904', lettuce, 0),
myrtle_12631 = ifelse(storenumber=='12631', lettuce, 0),
whitney_20974 = ifelse(storenumber=='46673', lettuce, 0)) %>%
select(-storenumber, -lettuce) %>%
group_by(date) %>%
summarise(ninth_46673 = sum(ninth_46673),
shattuck_4904 = sum(shattuck_4904),
myrtle_12631 = sum(myrtle_12631),
whitney_20974 = sum(whitney_20974))
lettuce_demand_by_shop <- pos_ordersale %>%
inner_join(lettuce_demand_by_menuitem) %>%
select(date, storenumber, lettuce_dde) %>%
mutate(storenumber = as.character(storenumber)) %>%
filter(storenumber %in% c('46673', '4904', '12631', '20974')) %>%
mutate(ninth_46673 = ifelse(storenumber=='46673', lettuce_dde, 0),
shattuck_4904 = ifelse(storenumber=='4904', lettuce_dde, 0),
myrtle_12631 = ifelse(storenumber=='12631', lettuce_dde, 0),
whitney_20974 = ifelse(storenumber=='46673', lettuce_dde, 0)) %>%
select(-storenumber, -lettuce_dde) %>%
group_by(date) %>%
summarise(ninth_46673 = sum(ninth_46673),
shattuck_4904 = sum(shattuck_4904),
myrtle_12631 = sum(myrtle_12631),
whitney_20974 = sum(whitney_20974))
View(lettuce_demand_by_shop)
rm(list= ls()[!(ls() %in% c('lettuce_demand_by_shop'))])
write_csv(lettuce_demand_by_shop, './parsed_data/historical_demand_by_shop.csv')
# Demand Forecasting - Maria Athena B. Engesaeth
# 01_forecast
#
# Get Past Ingredient Demand ---------------------------------------------------
rm(list = ls())
library(readr)
library(magrittr)
library(tidyr)
library(dplyr)
select <- dplyr::select
library(lubridate)
library(stringr)
library(countreg)
library(DataCombine)
library(forecast)
# Load historical lettuce demand by shop -----------------------------------------
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv')
colnames(hist.demand)
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv') %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
View(hist.demand)
ninth_46673.ts <- ts(hist.demand$ninth_46673, frequency = 1, start = 1)
plot.ts(ninth_46673.ts)
shattuck_4904.ts <- ts(hist.demand$shattuck_4904, frequency = 1, start = 1)
myrtle_12631.ts <- ts(hist.demand$myrtle_12631, frequency = 1, start = 1)
whitney_20974.ts <- ts(hist.demand$whitney_20974, frequency = 1, start = 1)
plot.ts(ninth_46673.ts)
plot.ts(shattuck_4904.ts)
matplot(hist.demand, type = c("b"),pch=1,col = 1:4) #plot
legend("topleft", legend = 1:4, col=1:4, pch=1) # optional legend
library(ggplot2)
ggplot(data = hist.demand, aes(x=x, y=val)) + geom_line(aes(colour=variable))
df <- data.frame(x=rep(1:5, 9), val=sample(1:100, 45),
variable=rep(paste0("category", 1:9), each=5))
df
View(df)
library(reshape2)
# Demand Forecasting - Maria Athena B. Engesaeth
# 01_ingredient_demand
#
# Get Data and Load Environment -------------------------------------------------------
source('./r/00_get_data.R')
# Get lettuce required for SUB RECIPES in grams ---------------------------------------
lettuce_sub_recipe <- sub_recipes %>%
left_join(sub_recipe_ingr_assignments) %>%
left_join(ingredients) %>%
left_join(portion_uom_types) %>%
select(subrecipeid, ingredientid, quantity, ingredientname, portiontypedescription) %>%
mutate(ingredientname = tolower(ingredientname)) %>%
mutate(lettuce = ifelse(grepl('lettuce', ingredientname), quantity, 0)) %>%
select(subrecipeid, lettuce, portiontypedescription) %>%
mutate(lettuce = ifelse(portiontypedescription == "Gram", lettuce, 28.35 * lettuce)) %>%
select(subrecipeid, lettuce) %>%
group_by(subrecipeid) %>%
summarise(lettuce = sum(lettuce)) %>%
mutate(lettuce = ifelse(lettuce == 0, NA, lettuce)) %>%
na.omit()
# Get lettuce required for RECIPES in grams -------------------------------------------
lettuce_recipe <- recipes %>%
left_join(recipe_ingredient_assignments) %>%
left_join(ingredients) %>%
left_join(portion_uom_types) %>%
select(recipeid, ingredientid, quantity, ingredientname, portiontypedescription) %>%
mutate(ingredientname = tolower(ingredientname)) %>%
mutate(lettuce = ifelse(grepl('lettuce', ingredientname), quantity, 0)) %>%
select(recipeid, lettuce, portiontypedescription) %>%
mutate(lettuce = ifelse(portiontypedescription == "Gram", lettuce, 28.35 * lettuce)) %>%
select(recipeid, lettuce) %>%
group_by(recipeid) %>%
summarise(lettuce = sum(lettuce)) %>%
mutate(lettuce = ifelse(lettuce == 0, NA, lettuce)) %>%
na.omit()
# Get lettuce required in TOTAL for menu items -----------------------------------------
# Connect SUBRECIPE to RECIPE by the associated factor
sub_to_recipe <- recipe_sub_recipe_assignments %>%
select(recipeid, subrecipeid, factor) %>%
inner_join(lettuce_sub_recipe, copy = TRUE) %>%
mutate(lettuce_sub = factor * lettuce) %>%
select(recipeid, subrecipeid, lettuce_sub)
# Amount of lettuce required in total for each recipe
total_lettuce <- lettuce_recipe %>%
full_join(sub_to_recipe, by=c('recipeid'='recipeid')) %>%
select(recipeid, subrecipeid, lettuce, lettuce_sub) %>%
rowwise() %>%
mutate(tot_lettuce = sum(lettuce, lettuce_sub, na.rm = TRUE)) %>%
select(-lettuce, -lettuce_sub, -subrecipeid)
# Amount of lettuce required in total for each recipe in menu_items
lettuce_menuitem <- menu_items %>%
inner_join(total_lettuce)
# Get historical demand of lettuce from past sales ------------------------------------
# Get past lettuce demand from sales/orders in menuitem
lettuce_demand_by_menuitem <- menuitem %>%
select(date, md5key_ordersale, id, plu, quantity) %>%
inner_join(lettuce_menuitem, by = c("id" = "menuitemid",
"plu" = "plu")) %>%
rowwise() %>%
mutate(lettuce = tot_lettuce * quantity) %>%
select(date, md5key_ordersale, lettuce) %>%
group_by(date, md5key_ordersale) %>%
summarise(lettuce_dde = sum(lettuce))
lettuce_demand_by_shop <- pos_ordersale %>%
inner_join(lettuce_demand_by_menuitem) %>%
select(date, storenumber, lettuce_dde) %>%
mutate(storenumber = as.character(storenumber)) %>%
filter(storenumber %in% c('46673', '4904', '12631', '20974'))
write_csv(lettuce_demand_by_shop, './parsed_data/historical_demand_by_shop_long.csv')
hist.demand_long <- read_csv('./parsed_data/historical_demand_by_shop_long.csv')
colnames(hist.demand_long)
ggplot(data = hist.demand_long, aes(x=x, y=val)) + geom_line(aes(colour=storenumber))
ggplot(data = hist.demand_long,
aes(x=date, y=lettuce_dde)) + geom_line(aes(colour=storenumber))
daily_demand %>%
ggplot(aes(x = date, y = lettuce_dde, colour = storenumber)) +
geom_line(size = 1.25) +
scale_x_date(date_breaks = "2 week") +
scale_color_brewer(type = "qual", palette = "Dark2")
hist.demand %>%
ggplot(aes(x = date, y = lettuce_dde, colour = storenumber)) +
geom_line(size = 1.25) +
scale_x_date(date_breaks = "2 week") +
scale_color_brewer(type = "qual", palette = "Dark2") +
facet_grid(store ~ .)
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv') %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv')
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv') %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
hist.demand %>%
ggplot(aes(x = date, y = lettuce_dde, colour = storenumber)) +
geom_line(size = 1.25) +
scale_x_date(date_breaks = "2 week") +
scale_color_brewer(type = "qual", palette = "Dark2") +
facet_grid(store ~ .)
hist.demand %>%
ggplot(aes(x = date, y = lettuce_dde, colour = storenumber)) +
geom_line(size = 1.25) +
scale_x_date(date_breaks = "2 week") +
scale_color_brewer(type = "qual", palette = "Dark2") +
facet_grid(store ~ .) +
guides(colour = guide_legend(title = "Store state")) +
xlab("") +
ylab("Demand for lettuce (g)")
colnames(hist.demand_long)
colnames(hist.demand)
hist.demand_long %>%
ggplot(aes(x = date, y = lettuce_dde, colour = storenumber))
hist.demand_long %>%
ggplot(aes(x = date, y = lettuce_dde, colour = storenumber)) +
geom_line(size = 1.25) +
scale_x_date(date_breaks = "2 week")
hist.demand %>%
ggplot(aes(x = date, y = lettuce_dde, colour = ninth_46673))
hist.demand$ninth_46673 %>%
ggplot(aes(x = day, y = lettuce_dde))
ggplot(ninth_46673.ts, aes(x = day, y = lettuce_dde))
plot.ts(ninth_46673.ts)
ninth_46673.ts <- ts(hist.demand$ninth_46673, frequency = 1, start = 1)
shattuck_4904.ts <- ts(hist.demand$shattuck_4904, frequency = 1, start = 1)
myrtle_12631.ts <- ts(hist.demand$myrtle_12631, frequency = 1, start = 1)
whitney_20974.ts <- ts(hist.demand$whitney_20974, frequency = 1, start = 1)
plot.ts(ninth_46673.ts)
plot.ts(shattuck_4904.ts)
plot.ts(ninth_46673.ts)
plot.ts(myrtle_12631.ts)
plot.ts(whitney_20974.ts)
ninth_46673.HW <- HoltWinters(shampoo, gamma=FALSE)
ninth_46673.HW <- HoltWinters(ninth_46673.ts, gamma=FALSE)
plot(ninth_46673.HW)
ninth_46673.ets <- ets(ninth_46673.ts, model="ZZZ")
ninth_46673.ets <- ets(ninth_46673.ts, model="ZZZ")
lines(fittted(ninth_46673.ets, col="green", lty=2))
ninth_46673.ets <- ets(ninth_46673.ts, model="ZZZ")
lines(fittted(ninth_46673.ets, col="green", lty=2))
accuracy(shampoo.ets)
sqrt(ninth_46673.HW1$SSE/length(ninth_46673.ts))
sqrt(ninth_46673.HW$SSE/length(ninth_46673.ts))
# The accuracy command is from the forecast package
ninth_46673.A <- auto.arima(ninth_46673.ts, trace=TRUE, ic='aicc')
ninth_46673.diff <- diff(ninth_46673.ts, differences=1)
adf.test(ninth_46673.diff)
library(tseries)
ninth_46673.diff <- diff(ninth_46673.ts, differences=1)
adf.test(ninth_46673.diff)
kpss.test(ninth_46673.diff)
pp.test(ninth_46673.diff)
nsdiffs(ninth_46673.ts, m=12, test="ocsb", max.D=1)
ninth_46673.A <- auto.arima(ninth_46673.ts, trace=TRUE, ic='aicc')
auto.arima(ninth_46673.ts, trace=TRUE, ic='aicc')
ninth_46673.A <- Arima(shampoo, order=c(2,0,1),  include.drift=TRUE)
ninth_46673.A <- Arima(ninth_46673.ts, order=c(2,0,1),  include.drift=TRUE)
plot.ts(ninth_46673.A$residuals)
acf(ninth_46673.A$residuals, lag.max=20)
Box.test(ninth_46673.A$residuals, lag=20, type="Ljung-Box")
plot.ts(ninth_46673.A$residuals)
ninth_46673.HW_f <-forecast.HoltWinters(ninth_46673.HW)
plot(ninth_46673.HW_f)
lines(fitted(ninth_46673.HW_f), col="red")
Box.test(ninth_46673.HW_f$residuals, lag=20, type="Ljung-Box")
Box.test(ninth_46673.A$residuals, lag=20, type="Ljung-Box")
lines(fitted(ninth_46673.A), col="red")
Box.test(ninth_46673.HW_f$residuals, lag=20, type="Ljung-Box")
Box.test(ninth_46673.A$residuals, lag=20, type="Ljung-Box")
accuracy(ninth_46673.A)
accuracy(ninth_46673.HW)
accuracy(ninth_46673.HW_f)
test <-forecast.Arima(ninth_46673.ts, order=c(2,0,1),  include.drift=TRUE)
test <-forecast.Arima(ninth_46673.ts, order=c(2,0,1),  include.drift=TRUE)
shattuck_4904.HW <- HoltWinters(shattuck_4904.ts, gamma=FALSE)
shattuck_4904.HW_f <-forecast.HoltWinters(shattuck_4904.HW)
lines(fitted(shattuck_4904.HW_f), col="red")
rm(list = ls())
library(readr)
library(magrittr)
library(tidyr)
library(dplyr)
select <- dplyr::select
library(forecast)
library(tseries)
# Load historical lettuce demand by shop -----------------------------------------
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv') %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
# hist.demand_long <- read_csv('./parsed_data/historical_demand_by_shop_long.csv')
# Create timeseries for each row being historical daily demand of lettuce
ninth_46673.ts <- ts(hist.demand$ninth_46673, frequency = 1, start = 1)
shattuck_4904.ts <- ts(hist.demand$shattuck_4904, frequency = 1, start = 1)
myrtle_12631.ts <- ts(hist.demand$myrtle_12631, frequency = 1, start = 1)
whitney_20974.ts <- ts(hist.demand$whitney_20974, frequency = 1, start = 1)
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv') %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv')
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv') %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
shattuck_4904.ts <- ts(hist.demand$shattuck_4904, frequency = 1, start = 1)
shattuck_4904.HW <- HoltWinters(shattuck_4904.ts, gamma=FALSE)
shattuck_4904.HW_f <-forecast.HoltWinters(shattuck_4904.HW)
lines(fitted(shattuck_4904.HW_f), col="red")
shattuck_4904.diff <- diff(shattuck_4904.ts, differences=1)
auto.arima(shattuck_4904.ts, trace=TRUE, ic='aicc')
shattuck_4904.A <- Arima(shattuck_4904.ts, order=c(2,0,1),  include.drift=TRUE)
1
shattuck_4904.A <- Arima(shattuck_4904.ts, order=c(1,1,1),  include.drift=TRUE)
lines(fitted(shattuck_4904.A), col="red")
rm(list = ls())
rm(list = ls())
library(readr)
library(magrittr)
library(tidyr)
library(dplyr)
select <- dplyr::select
library(forecast)
library(tseries)
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv')
hist.demand <- hist.demand %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
ninth_46673.ts <- ts(hist.demand$ninth_46673, frequency = 1, start = 1)
shattuck_4904.ts <- ts(hist.demand$shattuck_4904, frequency = 1, start = 1)
myrtle_12631.ts <- ts(hist.demand$myrtle_12631, frequency = 1, start = 1)
whitney_20974.ts <- ts(hist.demand$whitney_20974, frequency = 1, start = 1)
plot.ts(ninth_46673.ts)
lines(fitted(ninth_46673.HW_f), col="red")
ninth_46673.HW <- HoltWinters(ninth_46673.ts, gamma=FALSE)
ninth_46673.HW_f <-forecast.HoltWinters(ninth_46673.HW)
# Visualise
lines(fitted(ninth_46673.HW_f), col="red")
shattuck_4904.HW <- HoltWinters(shattuck_4904.ts, gamma=FALSE)
shattuck_4904.HW_f <-forecast.HoltWinters(shattuck_4904.HW)
# Visualise
lines(fitted(shattuck_4904.HW_f), col="red")
gc()
rm(list = ls())
gc()
rm(list = ls())
library(readr)
library(magrittr)
library(tidyr)
library(dplyr)
select <- dplyr::select
library(forecast)
library(tseries)
# Load historical lettuce demand by shop -----------------------------------------
hist.demand <- read_csv('./parsed_data/historical_demand_by_shop.csv')
hist.demand <- hist.demand %>%
mutate(day = rownames(hist.demand)) %>%
select(-date)
shattuck_4904.ts <- ts(hist.demand$shattuck_4904, frequency = 1, start = 1)
shattuck_4904.HW <- HoltWinters(shattuck_4904.ts, gamma=FALSE)
shattuck_4904.HW_f <-forecast.HoltWinters(shattuck_4904.HW)
# Visualise
lines(fitted(shattuck_4904.HW_f), col="red")
shattuck_4904.diff <- diff(shattuck_4904.ts, differences=1)
auto.arima(shattuck_4904.ts, trace=TRUE, ic='aicc')
# Best model: ARIMA(2,0,1) with non-zero mean
shattuck_4904.A <- Arima(shattuck_4904.ts, order=c(1,1,1),  include.drift=TRUE)
lines(fitted(shattuck_4904.A), col="red")
Box.test(ninth_46673.HW_f$residuals, lag=20, type="Ljung-Box")
Box.test(shattuck_4904.HW_f$residuals, lag=20, type="Ljung-Box")
Box.test(shattuck_4904.A$residuals, lag=20, type="Ljung-Box")
accuracy(shattuck_4904.HW_f)
accuracy(shattuck_4904.HA)
accuracy(shattuck_4904.HA)
accuracy(shattuck_4904.A)
myrtle_12631.HW <- HoltWinters(myrtle_12631.ts, gamma=FALSE)
myrtle_12631.HW_f <-forecast.HoltWinters(myrtle_12631.HW)
myrtle_12631.ts <- ts(hist.demand$myrtle_12631, frequency = 1, start = 1)
whitney_20974.ts <- ts(hist.demand$whitney_20974, frequency = 1, start = 1)
myrtle_12631.HW <- HoltWinters(myrtle_12631.ts, gamma=FALSE)
myrtle_12631.HW_f <-forecast.HoltWinters(myrtle_12631.HW)
# Visualise
lines(fitted(shattuck_4904.HW_f), col="red")
myrtle_12631.diff <- diff(myrtle_12631.ts, differences=1)
auto.arima(myrtle_12631.ts, trace=TRUE, ic='aicc')
myrtle_12631.A <- Arima(shattuck_4904.ts, order=c(0,1,1),  include.drift=TRUE)
lines(fitted(myrtle_12631.A), col="red")
Box.test(myrtle_12631.HW_f$residuals, lag=20, type="Ljung-Box")
Box.test(myrtle_12631.A$residuals, lag=20, type="Ljung-Box")
accuracy(myrtle_12631.HW_f)
accuracy(myrtle_12631.A)
whitney_20974.HW <- HoltWinters(whitney_20974.ts, gamma=FALSE)
whitney_20974.HW_f <-forecast.HoltWinters(whitney_20974.HW)
lines(fitted(whitney_20974.HW_f), col="red")
whitney_20974.diff <- diff(whitney_20974.ts, differences=1)
auto.arima(whitney_20974.ts, trace=TRUE, ic='aicc')
whitney_20974.A <- Arima(whitney_20974.ts, order=c(2,0,1),  include.drift=TRUE)
lines(fitted(whitney_20974.A), col="red")
Box.test(whitney_20974.HW_f$residuals, lag=20, type="Ljung-Box")
Box.test(whitney_20974.A$residuals, lag=20, type="Ljung-Box")
accuracy(whitney_20974.HW_f)
accuracy(whitney_20974.A)
